# Railway Deployment Guide

## Step 1: Create Railway Account
1. Go to: https://railway.app
2. Sign up with GitHub account
3. Connect your GitHub repository

## Step 2: Create New Project
1. Click: New Project
2. Select: Deploy from GitHub repo
3. Choose your repository: `dinning`
4. Select: `backend` as root directory
5. Railway will automatically detect it's a Python Flask app

## Step 3: Add PostgreSQL Database
1. In your Railway project dashboard
2. Click: New → Database → PostgreSQL
3. Railway will automatically:
   - Create a PostgreSQL database
   - Generate DATABASE_URL environment variable
   - Connect it to your app

## Step 4: Configure Environment Variables
Go to your project → Variables tab and add these:

```env
FLASK_ENV=production
SECRET_KEY=your-generated-secret-key-here
JWT_SECRET_KEY=your-generated-jwt-secret-here
OPENAI_API_KEY=your-openai-api-key
GOOGLE_APPLICATION_CREDENTIALS=/app/service-account-key.json
GOOGLE_PLAY_DEVELOPER_EMAIL=your-email@gmail.com
ALLOWED_ORIGINS=*
CORS_ORIGINS=*
```

## Step 5: Upload Service Account Key
1. Create `service-account-key.json` in your backend directory
2. Copy your Google service account JSON content
3. Commit and push to GitHub:
   ```bash
   git add backend/service-account-key.json
   git commit -m "Add Google service account key"
   git push origin main
   ```

## Step 6: Deploy
1. Railway will automatically deploy when you push to main
2. Monitor deployment in Railway dashboard
3. Check logs for any errors

## Step 7: Run Database Migrations
After successful deployment:
1. Go to your Railway project → Service → Terminal
2. Run: `flask db upgrade`
3. Or from local terminal: `railway run flask db upgrade`

## Step 8: Test Deployment
1. Get your Railway app URL (e.g., `https://your-app.railway.app`)
2. Test health endpoint: `https://your-app.railway.app/api/health`
3. Should return: `{"status": "healthy"}`

## Step 9: Update Flutter App
Update `lib/config/app_config.dart`:
```dart
class AppConfig {
  static const String baseUrl = 'https://your-app.railway.app';
  // ... rest of config
}
```

## Environment Variables Reference:
- `DATABASE_URL`: Auto-generated by Railway
- `FLASK_ENV`: Set to `production`
- `SECRET_KEY`: Generate with `python -c "import secrets; print(secrets.token_hex(32))"`
- `JWT_SECRET_KEY`: Generate with `python -c "import secrets; print(secrets.token_hex(32))"`
- `OPENAI_API_KEY`: Your OpenAI API key
- `GOOGLE_APPLICATION_CREDENTIALS`: Path to service account JSON
- `GOOGLE_PLAY_DEVELOPER_EMAIL`: Your Google Play Console email

## Troubleshooting:
- Check Railway logs for deployment errors
- Verify all environment variables are set
- Ensure service account JSON is properly uploaded
- Test database connection with `railway run python -c "from models import db; print('DB OK')"` 